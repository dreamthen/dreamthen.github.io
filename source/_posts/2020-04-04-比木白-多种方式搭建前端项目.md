---
title: æ¯”æœ¨ç™½-å¤šç§æ–¹å¼æ­å»ºé¡¹ç›®
date: 2020-04-04 14:04:49
tags: [web,nodejs,express,webpack,react,webpack-dev-server]
categories: web
comments: true
---

# express+react+webpack

> åŸå› 

  æœ€è¿‘åœ¨å†™æ‹“æµ·å®˜ç½‘çš„åå°webé¡¹ç›®,æœ¬æ¥æ˜¯æƒ³ç”¨webpack-dev-serveræ­å»ºå¼€å‘ç¯å¢ƒæœåŠ¡å™¨çš„,åæ¥æŸ¥èµ„æ–™å‘ç°,webpack-dev-serveræ²¡æœ‰express+webpack-dev-middleware+webpack-hot-middlewareçµæ´»,ä¸”ç¬¬äºŒç§æ–¹æ¡ˆçƒ­æ›´æ–°èµ°çš„æ˜¯å†…å­˜,æ‰€ä»¥å°±å°è¯•äº†ä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆã€‚
  æ­å»ºå¥½ä¹‹å,å‘ç°ç¬¬äºŒç§æ–¹æ¡ˆç”¨èµ·æ¥è¶…çº§çˆ½,æ—¢å¯ä»¥é…ç½®webpack,ä¹Ÿå¯ä»¥çµæ´»è‡ªç”±çš„é…ç½®expressæœåŠ¡å™¨å’Œå„ä¸ªä¸­é—´ä»¶,å¦å¤–ç”±äºæˆ‘ä»¬æ˜¯å¤šå…¥å£çš„æ‰“åŒ…(å°±æ˜¯æ¯æ¬¡æ‰“åŒ…,åªæ‰“åŒ…é¡¹ç›®ä¸­çš„ä¸€éƒ¨åˆ†,ä¹Ÿå°±æ˜¯æƒ³æ‰“åŒ…çš„å…¥å£é¡µé¢),æ‰€ä»¥ä½¿ç”¨ç¬¬äºŒç§çµæ´»çš„æ–¹æ¡ˆå¾ˆé€‚åˆç°æœ‰çš„éœ€æ±‚ã€‚
  
> è¯¦æƒ… é¦–å…ˆæˆ‘ä»¬å…ˆä¸‹è½½éœ€è¦çš„è¿›è¡Œé…ç½®çš„ç¬¬ä¸‰æ–¹å¤–éƒ¨ä¾èµ–åŒ…,è¿™äº›ç¬¬ä¸‰æ–¹å¤–éƒ¨ä¾èµ–åŒ…çš„ä½¿ç”¨å’Œä½œç”¨ä¼šåœ¨ä¹‹åä»‹ç»
  
  ```shell script
     npm install webpack webpack-cli @babel/cli @babel/core babel-loader @babel/preset-env @babel/preset-react file-loader url-loader core-js style-loader css-loader postcss-loader less-loader less ts-loader extract-text-webpack-plugin@next mini-css-extract-plugin express webpack-dev-middleware webpack-hot-middleware @babel/plugin-transform-runtime @babel/plugin-proposal-decorators @babel/plugin-proposal-class-properties @babel/runtime-corejs3 @babel/runtime autoprefixer webpack-bundle-analyzer html-webpack-plugin yargs shelljs ora glob cross-env http-proxy-middleware happypack terser-webpack-plugin --save-dev
  ```

> é…ç½®babel.config.jsç¼–è¯‘æ–‡ä»¶
  
  @babel/preset-env æ˜¯babelè¿›è¡Œç¼–è¯‘es2015è¯­æ³•ä»¥ä¸Šçš„æ¨¡å—,è¿™é‡Œä¸ºäº†å…¼å®¹æ›´è€çš„æµè§ˆå™¨,æ¯”å¦‚è¯´IE8,ä½¿ç”¨äº†core-jsæ¨¡å—æ³¨å…¥åˆ°å…¥å£å¤„,å±æ€§æŒ‰éœ€åŠ è½½@babel/runtime-corejs3æ¨¡å—:core-jsç¬¬ä¸‰ç‰ˆæœ¬
  
  @babel/preset-react æ˜¯babelè¿›è¡Œç¼–è¯‘react jsxè¯­æ³•çš„æ¨¡å—
  
  @babel/plugin-proposal-decorators æ˜¯babelè¿›è¡Œç¼–è¯‘ @xxx è¿™ç§è£…é¥°å™¨çš„æ¨¡å—
  
  @babel/plugin-proposal-class-properties æ˜¯babelè¿›è¡Œç¼–è¯‘ ç±»ä¼¼äºjså˜é‡ç±»å‹è§„èŒƒ,æ¯”å¦‚prop-typesè¿™ç§ç¬¬ä¸‰æ–¹å¤–éƒ¨ä¾èµ–åŒ…çš„æ¨¡å—
  
  ```js
    const config = {
        presets: [
            [
                '@babel/preset-env',
                {
                    useBuiltIns: 'entry',
                    corejs: 3
                }
            ],
            '@babel/preset-react'
        ],
        plugins: [
            [
                '@babel/plugin-proposal-decorators',
                {
                    legacy: true
                }
            ],
            '@babel/plugin-proposal-class-properties',
            [
                '@babel/plugin-transform-runtime',
                {
                    helpers: false,
                    regenerator: true
                }
            ]
        ]
    };
    
    module.exports = config;
  ```

> é…ç½®å¤šå…¥å£éƒ¨åˆ†é¡µé¢æ‰“åŒ…ã€å‹ç¼©ã€ç¼“å­˜å’Œæ¶ˆé™¤æ‰€æœ‰æ³¨é‡Š
  
  yargs æ­¤æ¨¡å—ç”¨äºä¼ é€’å‘½ä»¤è¡Œä¼ é€’å‚æ•°,ä¸æ˜¯ä»¥{key: 'value'}å¯¹è±¡çš„è¿™ç§ç»“æ„,è€Œæ˜¯ä½¿ç”¨æ•°ç»„çš„æ•°æ®ç»“æ„,å°†å¤–éƒ¨çš„å‚æ•°ä»¥å­—ç¬¦ä¸²çš„å½¢å¼æ¥ä¼ é€’
  
  ora æ­¤æ¨¡å—ä½¿è¾“å‡ºçš„å‘½ä»¤è¡Œæ›´æœ‰æ´»åŠ›æ›´æœ‰è‰²å½©æ›´æœ‰ä»ªå¼æ„Ÿ,æ¯”å¦‚è¯´ora().file('error'),å¦‚æœæ‰§è¡Œåˆ°è¿™ä¸€å¥,å‘½ä»¤è¡Œå°±ä¼šè¾“å‡º âœ– error
  
  glob æ­¤æ¨¡å—å°†æ‰€æœ‰æŸ¥åˆ°çš„æ–‡ä»¶ä»¥æ•°ç»„çš„æ•°æ®ç»“æ„,åœ¨å›è°ƒå‡½æ•°é‡Œé¢å‘ˆç°å‡ºæ¥,å›è°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°err,å¦‚æœæ‰¾ä¸åˆ°æ–‡ä»¶ç­‰å…¶ä»–é”™è¯¯,å°±ä¼šæŠ¥é”™;ç¬¬äºŒä¸ªå‚æ•°files,å°±æ˜¯æŸ¥åˆ°çš„æ–‡ä»¶æ•°ç»„
  
  shelljs æ­¤æ¨¡å—åœ¨jsæ–‡ä»¶ä¸­,ä½¿ç”¨æ­¤æ¨¡å—,å¯ä»¥åœ¨jsè¯­æ³•ä¸­,ä½¿ç”¨å‘½ä»¤è¡Œå‘½ä»¤
  
  ```js
    const yargs = require('yargs'),
        ora = require('ora'),
        glob = require('glob'),
        shelljs = require('shelljs');
    
    const params = yargs.argv._[0];
    
    if (!params) {
        ora().succeed('å¿…é¡»ä¼ é€’å‚æ•°!');
        return false;
    }
    
    const start = () => {
        glob('src/**/app.jsx', (err, files) => {
            if(err) {
                ora({
                    color: 'red'
                }).stopAndPersist({
                    symbol: 'âœ–',
                    text: 'æ²¡æœ‰æ‰¾åˆ°æ­¤æ–‡ä»¶'
                });
            }
            const file = files.find(item => item.indexOf(params) !== -1) || '';
            shelljs.exec(`npm set TARGET ${file} && node server.js`);
            ora({
                color: 'green'
            }).stopAndPersist({
                symbol: 'âœ”',
                text: 'å¼€å‘ç¯å¢ƒæœåŠ¡å™¨å¯åŠ¨æˆåŠŸ~'
            })
        });
    };
    
    start();
  ```

> é…ç½®webpackæ‰“åŒ…å¼€å‘ç¯å¢ƒ
  
  path è¯¥nodejsæ¨¡å—ç”¨äºè·¯å¾„å¯¼èˆªå’Œè·¯å¾„æ‹¼æ¥ç­‰åŠŸèƒ½
  
  terser-webpack-plugin è¯¥æ¨¡å—ç”¨äºå¯¹js es2015è¯­æ³•çš„ä»£ç çš„å‹ç¼©
  
  html-webpack-plugin è¯¥æ¨¡å—ä»¥æŸä¸€ä¸ªæ¨¡ç‰ˆå¼•æ“æˆ–è€…æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶ä½œä¸ºåŸºå‡†è¿›è¡Œå¤„ç†,å°†æå–å‡ºæ¥çš„æ¨¡å—(js,css,image...)ç­‰å…¶ä»–èµ„æºæ³¨å…¥åˆ°å…¶æ¨¡æ¿ä¸­
  
  happypack è¯¥æ¨¡å—èƒ½å¤Ÿæé«˜æ‰“åŒ…å’Œç¼–è¯‘çš„é€Ÿåº¦,ä½¿ç”¨å¤šè¿›ç¨‹è¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…,å°†ä¸»è¿›ç¨‹åˆ†ä¸ºæŒ‡å®šçš„å¤šä¸ªåˆ†è¿›ç¨‹,å½“è¾“å‡ºç¼–è¯‘çš„æ‰“åŒ…æ—¶,ä¼šå°†å¤šä¸ªåˆ†è¿›ç¨‹åˆå¹¶ä¸ºä¸€ä¸ªä¸»è¿›ç¨‹
  
  webpack-hot-middleware è¯¥æ¨¡å—å¯ä»¥å¯¹å¼€å‘ç¯å¢ƒè¿›è¡Œèµ„æºçƒ­åŠ è½½,å½“é¡¹ç›®ä¸­çš„æ–‡ä»¶å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶,èµ„æºçƒ­åŠ è½½å°±ä¼šç”Ÿæ•ˆ,å¼•èµ·å¼€å‘ç¯å¢ƒæœåŠ¡å™¨çš„é‡æ–°åˆ·æ–°
  
  webpack-bundle-analyzer è¯¥æ¨¡å—å¯ä»¥æŸ¥çœ‹æ‰“åŒ…ä¹‹åå„ä¸ªå…¥å£æ¨¡å—èµ„æºçš„å¤§å°ã€ä½“ç§¯ã€åç§°ä»¥åŠæ‰“åŒ…å‹ç¼©ä¹‹åçš„æ‰€æœ‰çš„ç‰¹å¾
  
  å¯¹äºå¼€å‘ç¯å¢ƒçš„csså’Œlessç­‰æ ·å¼æ–‡ä»¶çš„ç¼–è¯‘ã€æ‰“åŒ…ã€ç¼“å­˜ä»¥åŠå‹ç¼©,æœ¬äººä¸æ¨èä½¿ç”¨extract-text-webpack-pluginå’Œmini-css-extract-plugin,å¦‚æœè¿›è¡Œå¯¹csså’Œlessç­‰æ ·å¼æ–‡ä»¶è¿›è¡ŒæŠ½å–,å½“æ ·å¼æ–‡ä»¶å‘ç”Ÿæ”¹å˜æ—¶,æŸ¥æ‰¾äº†å¥½å¤šèµ„æ–™,ä¹Ÿä½¿ç”¨äº†å¾ˆå¤šæ–¹æ³•,æ¯”å¦‚css-hot-loader,éƒ½ä¸ä¼šå¼•èµ·èµ„æºçƒ­åŠ è½½,åæ¥å‘ç°äººå®¶æ˜¯æœ‰æ³¨é‡Šçš„: MiniCssExtractPlugin doesn't support HMR;For developing, use 'style-loader' instead.
  
  ![](/images/notSupportHMR.png)
  
  è¯´æ˜åœ¨å¼€å‘ç¯å¢ƒ,mini-css-extract-pluginä¿®æ”¹æ ·å¼æ–‡ä»¶,æ²¡åŠæ³•å¼•èµ·èµ„æºçƒ­åŠ è½½
  
  ```js
    const path = require('path'),
        webpack = require('webpack'),
        HappyPack = require('happypack'),
        TerserWebpackPlugin = require('terser-webpack-plugin'),
        ExtractWebpackPlugin = require('extract-text-webpack-plugin'),
        MiniCssExtractPlugin = require('mini-css-extract-plugin'),
        HtmlWebpackPlugin = require('html-webpack-plugin'),
        BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;
    
    const PUBLIC_DIR = '/',
        OUTPUT_DIR = path.resolve(__dirname, '../build'),
        TEMPLATE_DIR = path.resolve(__dirname, '../public'),
        SRC_DIR = path.resolve(__dirname, '../src');
    
    const TARGET = `./${process.env.npm_config_TARGET}`;
    
    module.exports = {
        devtool: 'eval',
        mode: 'development',
        entry: {
            app: [
                //åœ¨å…¥å£å¤„é…ç½®çƒ­åŠ è½½æ¨¡å—çš„å®¢æˆ·ç«¯é…ç½®,è®¾ç½®èµ„æºçƒ­åŠ è½½å†…å®¹å˜åŒ–æ—¶,å¼€å‘ç¯å¢ƒæœåŠ¡å™¨é‡æ–°åˆ·æ–°,ç›®å½•é…ç½®åˆ™æ˜¯__webpack_hmr'
                'webpack-hot-middleware/client?path=__webpack_hmr&reload=true',
                TARGET
            ]
        },
        output: {
            publicPath: PUBLIC_DIR,
            filename: `js/[name].[hash].js`,
            path: OUTPUT_DIR
        },
        resolve: {
            modules: [
                'node_modules',
                SRC_DIR
            ]
        },
        externals: {
            jquery: 'jQuery'
        },
        optimization: {
            runtimeChunk: true,
            minimizer: [
                new TerserWebpackPlugin({
                    //æ˜¯å¦å¼€å¯ç¼“å­˜æœºåˆ¶
                    cache: true,
                    //æ˜¯å¦å¼€å¯å¤šæ ¸å‹ç¼©æœºåˆ¶
                    parallel: true,
                    terserOptions: {
                        output: {
                            //æ˜¯å¦åˆ é™¤é™¤äº†å«æœ‰@licenseæ„å¤–å…¶ä»–æ‰€æœ‰çš„æ³¨é‡Š
                            comments: /@license/i
                        },
                        mangle: {
                            //å¼€å¯å¯¹ie8æµè§ˆå™¨çš„å…¼å®¹
                            ie8: true,
                            //å¼€å¯å¯¹IOS 10ç³»ç»Ÿçš„å…¼å®¹
                            safari10: true
                        }
                    },
                    //æ˜¯å¦åˆ é™¤æ‰€æœ‰çš„æ³¨é‡Š
                    extractComments: true
                })
            ],
            splitChunks: {
                chunks: 'all',
                minSize: 0,
                minChunks: 1,
                cacheGroups: {
                    base: {
                        name: 'base',
                        minSize: 0,
                        minChunks: 1,
                        chunks: 'initial',
                        test: (module)=>{
                            return /(react|react-dom|lodash|moment|react-router)/.test(module.context)
                        }
                    },
                    commons: {
                        name: 'commons',
                        minSize: 0,
                        minChunks: 1,
                        chunks: 'initial'
                    }
                }
            }
        },
        module: {
            rules: [{
                test: /\.js[x]?$/,
                include: [
                    SRC_DIR
                ],
                use: [
                    //happypackå¯¹jsä»¥åŠjsxæ–‡ä»¶è¿›è¡Œå¤„ç†,idä¸ºjsx
                    'happypack/loader?id=jsx'
                ]
            }, {
                test: /\.css$/,
                //åœ¨ä¸ä½¿ç”¨style-loaderçš„æƒ…å†µä¸‹,å¯ä»¥ä½¿ç”¨extract-text-webpack-pluginå’Œmini-css-extract-pluginå°†cssæ ·å¼æŠ½æˆæ–‡ä»¶
                /**
                    use: ExtractWebpackPlugin.extract({
                        fallback: 'style-loader',
                        use: ['happypack/loader?id=css']
                    })
                */
                
                use: [
                    //MiniCssExtractPlugin.loader,
                    /**
                        {
                            loader: MiniCssExtractPlugin.loader,
                            options: {
                                //åªåœ¨å¼€å‘ç¯å¢ƒå¼€å¯èµ„æºçƒ­æ›´æ–°
                                hmr: process.env.NODE_ENV === 'development',
                                //å½“çƒ­æ›´æ–°å¤±æ•ˆæ—¶,æ˜¯å¦å¼ºåˆ¶åˆ·æ–°æ›´æ–°èµ„æº
                                reloadAll: true
                            }
                        }
                    */
                    //happypackå¯¹cssæ–‡ä»¶è¿›è¡Œå¤„ç†,idä¸ºcss
                    'happypack/loader?id=css'
                ]
            }, {
                test: /\.less$/,
                //åœ¨ä¸ä½¿ç”¨style-loaderçš„æƒ…å†µä¸‹,å¯ä»¥ä½¿ç”¨extract-text-webpack-pluginå’Œmini-css-extract-pluginå°†lessæ ·å¼æŠ½æˆæ–‡ä»¶
                /**
                    use: ExtractWebpackPlugin.extract({
                        fallback: 'style-loader',
                        use: ['happypack/loader?id=less']
                    })
                */
                use: [
                    //MiniCssExtractPlugin.loader,
                    /**
                        {
                            loader: MiniCssExtractPlugin.loader,
                            options: {
                                //åªåœ¨å¼€å‘ç¯å¢ƒå¼€å¯èµ„æºçƒ­æ›´æ–°
                                hmr: process.env.NODE_ENV === 'development',
                                //å½“çƒ­æ›´æ–°ä¸ç”Ÿæ•ˆæ—¶,è¿›è¡Œå¼ºåˆ¶åˆ·æ–°æ›´æ–°èµ„æº
                                reloadAll: true
                            }
                        }
                    */
                    //happypackå¯¹lessæ–‡ä»¶è¿›è¡Œå¤„ç†,idä¸ºless
                    'happypack/loader?id=less'
                ]
            }, {
                test: /\.(png|jpeg|jpg|gif|bmp)$/,
                use: [
                    //happypackå¯¹imageå›¾ç‰‡æ–‡ä»¶è¿›è¡Œå¤„ç†,idä¸ºimage
                    //'happypack/loader?id=image'
                    {
                        loader: 'url-loader',
                        options: {
                            limit: 102400,
                            name: '[name].[hash:6].[ext]'    
                        }
                    }       
                ]
            }]
        },
        plugins: [
            new webpack.HotModuleReplacementPlugin(),
            /**
                new ExtractWebpackPlugin({
                    filename: 'css/[name].[hash:6].css'
                }),
            */
            /**
                new MiniCssExtractPlugin({
                    filename: 'css/[name].[hash:6].css'
                }),
            */
            new HappyPack({
                id: 'jsx',
                //å°†ä¸»è¿›ç¨‹åˆ†ä¸º4ä¸ªåˆ†è¿›ç¨‹è¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…
                threads: 4,
                loaders: [
                    //ä½¿ç”¨babel-loaderå¯¹jsä»¥åŠjsxæ–‡ä»¶è¿›è¡Œç¼–è¯‘
                    'babel-loader'
                ]
            }),
            new HappyPack({
                id: 'css',
                //å°†ä¸»è¿›ç¨‹åˆ†ä¸º2ä¸ªåˆ†è¿›ç¨‹è¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…
                threads: 2,
                loaders: [
                    //ä½¿ç”¨style-loader,css-loaderå’Œpostcss-loaderå¯¹cssæ–‡ä»¶è¿›è¡Œç¼–è¯‘
                    'style-loader',
                    {
                        loader: 'css-loader',
                        options: {
                            importLoaders: 1
                        }
                    },
                    'postcss-loader'
                ]
            }),
            new HappyPack({
                id: 'less',
                //å°†ä¸»è¿›ç¨‹åˆ†ä¸º2ä¸ªåˆ†è¿›ç¨‹è¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…
                threads: 2,
                loaders: [
                    //ä½¿ç”¨style-loader,css-loader,postcss-loaderå’Œless-loaderå¯¹cssæ–‡ä»¶è¿›è¡Œç¼–è¯‘
                    'style-loader',
                    {
                        loader: 'css-loader',
                        options: {
                            importLoaders: 2
                        }
                    },
                    {
                        loader: 'postcss-loader',
                        options: {
                            importLoaders: 1
                        }
                    },
                    'less-loader'
                ]
            }),
            //ç°åœ¨è¿˜ä¸èƒ½ä½¿ç”¨happypackå»å¤šè¿›ç¨‹æ‰“åŒ…ã€ç¼“å­˜å›¾ç‰‡ç­‰åº”ç”¨url-loaderæ¨¡å—çš„æ–‡ä»¶,ä¼šå‡ºç°base 64å›¾ç‰‡ç­‰æ–‡ä»¶åŠ è½½ä¸å‡ºæ¥çš„é—®é¢˜,å…·ä½“çœ‹ä¸‹é¢çš„é—®é¢˜ç»“è®ºé“¾æ¥
            /**
                new HappyPack({
                    id: 'image',
                    //å°†ä¸»è¿›ç¨‹åˆ†ä¸º4ä¸ªåˆ†è¿›ç¨‹è¿›è¡Œç¼–è¯‘å’Œæ‰“åŒ…
                    threads: 4,
                    loaders: [{
                        //ä½¿ç”¨url-loaderå¯¹imageæ–‡ä»¶è¿›è¡Œç¼–è¯‘
                        loader: 'url-loader',
                        options: {
                            limit: 102400,
                            name: '[name].[hash:6].[ext]'
                        }
                    }]
                }),
            **/
            new HtmlWebpackPlugin({
                //æ³¨å…¥æ¨¡å—(js,css,image...)ç­‰å…¶ä»–èµ„æºçš„ç›®å½•è·¯å¾„
                publicPath: PUBLIC_DIR,
                //å¤„ç†çš„æ¨¡æ¿å¼•æ“æˆ–è€…æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶çš„åç§°
                filename: 'index.html',
                //æ¨¡æ¿å¼•æ“æˆ–è€…æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶çš„ç›®å½•åœ°å€
                template: `${TEMPLATE_DIR}/index.ejs`,
                //é€‰æ‹©è¦æ³¨å…¥çš„æ¨¡å—åç§°
                chunks: ['base', 'commons', 'app'],
                //æ˜¯å¦å°†æ³¨å…¥çš„æ¨¡å—æ‰“ä¸Šhashå€¼
                hash: true,
                //æ³¨å…¥åˆ°æ¨¡æ¿å¼•æ“æˆ–è€…æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶çš„ä½ç½®
                inject: 'body',
                //æ˜¯å¦å‹ç¼©æ¨¡æ¿å¼•æ“æˆ–è€…æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶
                minify: true,
                //è¦ä¼ å…¥åˆ°æ¨¡æ¿å¼•æ“å½“ä¸­çš„å±æ€§å˜é‡
                templateParameters: {
                }
            }),
            new BundleAnalyzerPlugin()
        ]
    };
  ```

  PS: <a href='https://github.com/amireh/happypack/issues/240' target='_blank'>url-loaderé…åˆhappypack,base64å›¾ç‰‡åŠ è½½ä¸å‡ºæ¥</a>

> é…ç½®express+webpack-dev-middleware+webpack-hot-middlewareå¼€å‘æœåŠ¡å™¨

  express è¯¥æ¨¡å—ç”¨äºå¯åŠ¨nodejsæœåŠ¡å™¨,å¯ä»¥ä½œä¸ºè·¯ç”±ã€è¯·æ±‚ç­‰å¤„ç†,å…·ä½“æ–‡æ¡£åœ¨è¿™å„¿:<a href='https://expressjs.com/zh-cn/' target='_blank'>expressæ–‡æ¡£</a>
  
  http-proxy-middleware è¯¥æ¨¡å—ä½œä¸ºä¸­é—´ä»¶,å¯ä»¥å¤„ç†ä»£ç†æœåŠ¡å™¨è¯·æ±‚,ç±»ä¼¼äºwebpack-dev-server devServer proxyçš„é…ç½®
  
  http-dev-middleware è¯¥æ¨¡å—ä½œä¸ºä¸­é—´ä»¶,å¯ä»¥å¤„ç†èµ„æºçƒ­åŠ è½½çš„å¯åŠ¨
  
  http-hot-middleware è¯¥æ¨¡å—ä½œä¸ºä¸­é—´ä»¶,èµ„æºçƒ­åŠ è½½çš„ä¸»è¦å¤„ç†å·¥å…·

  ```js
    const express = require('express'),
          path = require('path'),
          ora = require('ora'),
          proxy = require('http-proxy-middleware'),
          webpack = require('webpack'),
          webpackDevMiddleware = require('webpack-dev-middleware'),
          webpackHotMiddleware = require('webpack-hot-middleware'),
          dev = require('./config/dev');
      
      const NODE_ENV = process.env.NODE_ENV,
          PORT = 8024;
      
      const app = express();
      
      app.use('/app', proxy.createProxyMiddleware({
          target: 'http://10.64.57.204',
          secure: false,
          changeOrigin: true
      }));
      
      if (NODE_ENV === 'development') {
          const compiler = webpack(dev);
          app.use(webpackDevMiddleware(compiler, {
              publicPath: dev.output.publicPath
          }));
          app.use(webpackHotMiddleware(compiler, {
              //è¿™é‡Œçš„heartbeat,å€¼å¾—æ˜¯æ¯éš”3s,ä¸€æ£€æµ‹èµ„æºå†…å®¹æ˜¯å¦å‘ç”Ÿå˜åŒ–,å¦‚æœå‘ç”Ÿäº†å˜åŒ–,å°±å¼ºåˆ¶èµ„æºçƒ­åŠ è½½
              heartbeat: 3000
          }));
          app.get('/', (req, res) => {
              const file = path.join(__dirname, 'public/index.ejs');
              //è¿™é‡Œç»è¿‡webpackæ‰“åŒ…ã€ç¼“å­˜ã€ç¼–è¯‘ä»¥åŠå¤šè¿›ç¨‹å¤„ç†ä¹‹å,ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè¯»å–æ¨¡æ¿å¼•æ“æˆ–è€…è¶…æ–‡æœ¬ä¼ è¾“åè®®æ–‡ä»¶,å°†å¤„ç†ä¹‹åçš„èµ„æºæ”¾å…¥åˆ°æ­¤æ–‡ä»¶ä¸­,å¹¶æ”¾å…¥åˆ°å¼€å‘ç¯å¢ƒæœåŠ¡å™¨è·¯ç”±ä¸­
              compiler.outputFileSystem.readFile(file, (err, result) => {
                  if (err) {
                      ora().stopAndPersist({
                          symbol: 'âœ–',
                          text: 'è¯»å–æ–‡ä»¶å‡ºç°é”™è¯¯ï½'
                      });
                  }
                  res.set('content-type', 'text/html');
                  res.send(result);
              });
          });
      } else {
      
      }
      
      app.listen(PORT, () => {
          ora().stopAndPersist({
              symbol: 'âœ”',
              text: `webç½‘ç«™å·²åœ¨localhost:${PORT}åŸŸåä¸­å¯åŠ¨`
          });
      });
  ```

> é…ç½®postcssæ‰©å±•æ ·å¼è¡¨

  autoprefixer è¯¥æ¨¡å—ç”¨äºcssçš„æ ·å¼æ‰©å±•,å…¼å®¹æ—§ç‰ˆæœ¬æµè§ˆå™¨çš„æ ·å¼

  ```js
    const autoprefixer = require('autoprefixer');
    
    module.exports = {
        plugins: [
            autoprefixer
        ]
    };
  ```
  
  package.json é…ç½®browserslistæµè§ˆå™¨å…¼å®¹ä»¥åŠç‰ˆæœ¬åˆ—è¡¨
  
  ```json
    
    {
      "browserslist": [
        "Chrome >= 35",
        "Firefox >= 31",
        "Explorer >= 9",
        "Safari >= 7.1",
        "Opera >= 12",
        "IOS >= 7",
        "Android >= 4"
      ]
    }
  ```

> æ¥ç€,æˆ‘ä»¬è¦ä¸‹è½½å®‰è£…ç¼–å†™ä¸šåŠ¡ä»£ç æ—¶çš„ç¬¬ä¸‰æ–¹å¤–éƒ¨ä¾èµ–åŒ…

  ```shell script
    npm install react react-dom prop-types --save
  ```

> ä¹‹å,æˆ‘ä»¬åœ¨æ¯ä¸ªå…¥å£å¤„è¿›è¡Œreacté…ç½®

  ```jsx harmony
   import React from 'react';
   import {render} from 'react-dom';
   
   render(<div>
        æˆ‘å«å°¹æ–‡æ¥·,ä¿ºæ˜¯ä¸€ä¸ªå¥½é“¶,ğŸ˜‚ğŸ˜‚ğŸ˜‚
   </div>, document.querySelector('#app'));
  ```
  
> æœ€å,æˆ‘ä»¬è¿›è¡Œé…ç½®index.ejsæˆ–è€…index.html(æ¨¡æ¿å¼•æ“æˆ–è€…è¶…æ–‡æœ¬ä¼ è¾“åè®®)

  ```html
    <!DOCTYPE html>
    <html lang="zh-cn">
    <head>
        <meta charset="UTF-8">
        <title>express+webpack+reactæ­å»ºä¸€ä¸ªwebé¡¹ç›®</title>
    </head>
    <body>
    <div id="app">
    
    </div>
    </body>
    </html>
  ```

æˆ‘ä»¬express+react+webpackæ–¹å¼æ­å»ºçš„webé¡¹ç›®å°±å·²ç»å®Œæˆäº†,æœ€åçš„æœ€åç»™å¤§å®¶å±•ç¤ºä¸€ä¸‹æˆ‘çš„ç›®å½•ç»“æ„

![](/images/catalogue.png)

# webpack+webpack-dev-server+react





  
